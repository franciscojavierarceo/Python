<html>
  <head>
    <title>Driver Homepage!</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body>
    <div class="container mx-auto col-xxl-8 px-4 py-5">
      <h1>Sign up to become a Feast Driver!</h1>
      <form id="onboardingForm">
        <div class="row mb-3">
          <div class="form-group mb-3">
            <label for="birthdate">Birthdate:</label>
            <input type="date" class="form-control" id="birthdate" name="birthdate" placeholder="12/23/2000">
          </div>
          <div class="form-group mb-3">
            <label for="ssn">Social Security Number:</label>
            <input type="text" class="form-control" id="ssn" name="ssn" placeholder="123-45-6789">
          </div>
          <div class="form-group mb-3">
            <label for="dl">Driver's License:</label>
            <input type="text" class="form-control" id="dl" name="dl" placeholder="some-dl-number">
          </div>
          <div class="form-group mb-3">
            <label for="state">State:</label>
            <input type="text" class="form-control" id="state" name="state" placeholder="NJ">
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
      <div id="message"></div>
    </div>
  <script>
    document.getElementById("onboardingForm").addEventListener("submit", function(event) {
      event.preventDefault();
      var birthdate = document.getElementById("birthdate").value;
      var ssn = document.getElementById("license").value;
      var license = document.getElementById("state").value;
      fetch("/onboarding-risk-decision", {
        method: "POST",
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          birthdate: birthdate,
          ssn: ssn,
          license: license,
          state: state,
        })
        .then(response => response.text())
        .then(data => {
          document.getElementById("message");
          if (data === "APPROVED") {
            message.innerHTML = '<div clas="alert alert-success mt-4">You\'re good to go!</div>';
          } else if (data === "DECLINED") {
            message.innerHTML = '<div clas="alert alert-danger mt-4">Sorry! You\'re not eleigible to drive right now.</div>';
          }
        })
        .catch((error) => {
          console.error("Error:", error);
        });
      });
      // Refreshing endpoint every minute
      setInterval(function() {
        fetch("/daily-risk-decision/1001/")
        .then(response => response.text())
          .then(data => {
            var message = document.getElementById("message");
            if (data === "APPROVED") {
              message.innerHTML = '<div clas="alert alert-success mt-4">You\'re good to go!</div>';
            } else if (data === "DECLINED") {
              message.innerHTML = '<div clas="alert alert-danger mt-4">Sorry! You\'re not eleigible to drive right now.</div>';
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }, 60000);
  </script>
  </body>
</html>
